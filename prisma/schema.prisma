// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql" // garde Ã§a si ta DB est bien Postgres
  url      = env("DATABASE_URL")
}

model TrainerBanking {
  id        String @id @default(cuid())
  // identifiant stable du formateur (customer id Shopify, email hash, etc.)
  trainerId String @unique

  email         String?
  payoutName    String?
  payoutCountry String?
  payoutIban    String?
  payoutBic     String?

  // infos / flags pour paiement automatique
  autoPayout Boolean @default(false)
  ibanLast4  String? // 4 derniers digits de lâ€™IBAN
  ibanToken  String? // token Stripe/autre, pas lâ€™IBAN en clair

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  summary PayoutsSummary?
  history PayoutsHistory[]
}

model PayoutsSummary {
  id        String @id @default(cuid())
  trainerId String @unique

  // ðŸ’¡ On passe en Float pour Ã©viter lâ€™erreur "Decimal non supportÃ©"
  availableAmount Float    @default(0.0)
  pendingAmount   Float    @default(0.0)
  currency        String   @default("EUR")
  updatedAt       DateTime @updatedAt

  trainer TrainerBanking @relation(fields: [trainerId], references: [trainerId])
}

model PayoutsHistory {
  id        String @id @default(cuid())
  trainerId String

  type     PayoutType
  status   PayoutStatus
  amount   Float // idem : Float au lieu de Decimal
  currency String       @default("EUR")
  date     DateTime     @default(now())
  meta     Json?

  trainer TrainerBanking @relation(fields: [trainerId], references: [trainerId])

  @@index([trainerId, date])
}

enum PayoutType {
  sale
  withdraw
  paid
}

enum PayoutStatus {
  available
  requested
  paid
  reversed
}
